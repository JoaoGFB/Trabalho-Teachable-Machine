<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle por Voz</title>
</head>
<body style="height:2000px;">
  <div>Controle de voz por áudio</div>

  <button type="button" onclick="init()">Iniciar Modelo</button>
  <div id="label-container"></div>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <!-- Teachable Machine Audio -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/audio@0.8/dist/teachablemachine-audio.min.js"></script>

  <button id="meuBotao" onclick="alert('Botão clicado!')">Botão Teste</button>

  <script type="text/javascript">
    const URL = "https://teachablemachine.withgoogle.com/models/_vkzA50iy/"; 
    let model, labelContainer, maxPredictions;
    let ativo = false;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      console.log("Carregando modelo de:", modelURL);

      // Carregar o modelo
      model = await tmAudio.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      console.log("Modelo carregado!", model);

      labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";

      for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
      }

      // Agora sim escutando o microfone
      await model.listen(resultados, {
        probabilityThreshold: 0.75,
        overlapFactor: 0.5
      });

      console.log("Escutando áudio...");
    }

    function resultados(predictions) {
      let maior = predictions.reduce((a, b) => a.probability > b.probability ? a : b);
      let comando = maior.className;

      labelContainer.innerHTML = "Detectado: " + comando;

      if (comando === "ligar") {
        ativo = true;
        console.log("Sistema ATIVADO");
        return;
      }
      if (comando === "desligar") {
        ativo = false;
        console.log("Sistema DESLIGADO");
        return;
      }

      if (!ativo) return;

      switch (comando) {
        case "subir":
          window.scrollBy(0, -200);
          break;
        case "descer":
          window.scrollBy(0, 200);
          break;
        case "proximo":
          console.log("Trocar para próximo slide");
          break;
        case "anterior":
          console.log("Trocar para slide anterior");
          break;
        case "Botão":
          document.getElementById("meuBotao").click();
          break;
      }
    }
  </script>
</body>
</html>